import{b as lt,B as H,ax as K,d as Y,c,L as J,v as rt,J as st,K as ut,P as it,bk as ct,o as Z,a as q,r as ft,g as dt,_ as mt,m as pt,S as gt,y as a,w as i,e as vt}from"./index.12244a07.js";import{E as _t,a as xt}from"./el-col.9d5e7896.js";import{E as ht,a as bt}from"./el-form-item.ce222cb9.js";import{E as yt}from"./el-space.f858acfb.js";/* empty css                 */import{E as St}from"./el-input-number.6962d3b9.js";import{E as Vt}from"./el-slider.f907c317.js";import{E as wt}from"./el-color-picker.03df0be4.js";import{E as Et}from"./index.318875f8.js";import"./_baseClone.ce459c13.js";import"./_Uint8Array.869745a5.js";import"./_initCloneObject.d1045298.js";import"./event.1aa8b38f.js";import"./index.e921f451.js";import"./debounce.b932a66e.js";import"./position.9ed88f6c.js";import"./index.bccee1bd.js";const zt=lt({zIndex:{type:Number,default:9},rotate:{type:Number,default:-22},width:Number,height:Number,image:String,content:{type:H([String,Array]),default:"Element Plus"},font:{type:H(Object)},gap:{type:H(Array),default:()=>[100,100]},offset:{type:H(Array)}});function kt(s){return s.replace(/([A-Z])/g,"-$1").toLowerCase()}function Mt(s){return Object.keys(s).map(t=>`${kt(t)}: ${s[t]};`).join(" ")}function $t(){return window.devicePixelRatio||1}const Ct=(s,t)=>{let p=!1;return s.removedNodes.length&&t&&(p=Array.from(s.removedNodes).includes(t)),s.type==="attributes"&&s.target===t&&(p=!0),p},Q=3;function X(s,t,p=1){const n=document.createElement("canvas"),x=n.getContext("2d"),g=s*p,z=t*p;return n.setAttribute("width",`${g}px`),n.setAttribute("height",`${z}px`),x.save(),[x,n,g,z]}function Bt(){function s(t,p,n,x,g,z,f,L){const[d,S,v,V]=X(x,g,n);if(t instanceof HTMLImageElement)d.drawImage(t,0,0,v,V);else{const{color:y,fontSize:I,fontStyle:R,fontWeight:U,fontFamily:et,textAlign:ot,textBaseline:nt}=z,G=Number(I)*n;d.font=`${R} normal ${U} ${G}px/${g}px ${et}`,d.fillStyle=y,d.textAlign=ot,d.textBaseline=nt;const j=K(t)?t:[t];j==null||j.forEach((D,at)=>{d.fillText(D!=null?D:"",v/2,at*(G+Q*n))})}const h=Math.PI/180*Number(p),l=Math.max(x,g),[T,O,w]=X(l,l,n);T.translate(w/2,w/2),T.rotate(h),v>0&&V>0&&T.drawImage(S,-v/2,-V/2);function _(y,I){const R=y*Math.cos(h)-I*Math.sin(h),U=y*Math.sin(h)+I*Math.cos(h);return[R,U]}let k=0,A=0,N=0,F=0;const P=v/2,M=V/2;[[0-P,0-M],[0+P,0-M],[0+P,0+M],[0-P,0+M]].forEach(([y,I])=>{const[R,U]=_(y,I);k=Math.min(k,R),A=Math.max(A,R),N=Math.min(N,U),F=Math.max(F,U)});const e=k+w/2,o=N+w/2,r=A-k,b=F-N,E=f*n,$=L*n,W=(r+E)*2,C=b+$,[B,u]=X(W,C);function m(y=0,I=0){B.drawImage(O,e,o,r,b,y,I,r,b)}return m(),m(r+E,-b/2-$/2),m(r+E,+b/2+$/2),[u.toDataURL(),W/n,C/n]}return s}const It=Y({name:"ElWatermark"}),Wt=Y({...It,props:zt,setup(s){const t=s,p={position:"relative"},n=c(()=>{var e,o;return(o=(e=t.font)==null?void 0:e.color)!=null?o:"rgba(0,0,0,.15)"}),x=c(()=>{var e,o;return(o=(e=t.font)==null?void 0:e.fontSize)!=null?o:16}),g=c(()=>{var e,o;return(o=(e=t.font)==null?void 0:e.fontWeight)!=null?o:"normal"}),z=c(()=>{var e,o;return(o=(e=t.font)==null?void 0:e.fontStyle)!=null?o:"normal"}),f=c(()=>{var e,o;return(o=(e=t.font)==null?void 0:e.fontFamily)!=null?o:"sans-serif"}),L=c(()=>{var e,o;return(o=(e=t.font)==null?void 0:e.textAlign)!=null?o:"center"}),d=c(()=>{var e,o;return(o=(e=t.font)==null?void 0:e.textBaseline)!=null?o:"hanging"}),S=c(()=>t.gap[0]),v=c(()=>t.gap[1]),V=c(()=>S.value/2),h=c(()=>v.value/2),l=c(()=>{var e,o;return(o=(e=t.offset)==null?void 0:e[0])!=null?o:V.value}),T=c(()=>{var e,o;return(o=(e=t.offset)==null?void 0:e[1])!=null?o:h.value}),O=()=>{const e={zIndex:t.zIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let o=l.value-V.value,r=T.value-h.value;return o>0&&(e.left=`${o}px`,e.width=`calc(100% - ${o}px)`,o=0),r>0&&(e.top=`${r}px`,e.height=`calc(100% - ${r}px)`,r=0),e.backgroundPosition=`${o}px ${r}px`,e},w=J(null),_=J(),k=rt(!1),A=()=>{_.value&&(_.value.remove(),_.value=void 0)},N=(e,o)=>{var r;w.value&&_.value&&(k.value=!0,_.value.setAttribute("style",Mt({...O(),backgroundImage:`url('${e}')`,backgroundSize:`${Math.floor(o)}px`})),(r=w.value)==null||r.append(_.value),setTimeout(()=>{k.value=!1}))},F=e=>{let o=120,r=64;const b=t.image,E=t.content,$=t.width,W=t.height;if(!b&&e.measureText){e.font=`${Number(x.value)}px ${f.value}`;const C=K(E)?E:[E],B=C.map(u=>{const m=e.measureText(u);return[m.width,m.fontBoundingBoxAscent!==void 0?m.fontBoundingBoxAscent+m.fontBoundingBoxDescent:m.actualBoundingBoxAscent+m.actualBoundingBoxDescent]});o=Math.ceil(Math.max(...B.map(u=>u[0]))),r=Math.ceil(Math.max(...B.map(u=>u[1])))*C.length+(C.length-1)*Q}return[$!=null?$:o,W!=null?W:r]},P=Bt(),M=()=>{const o=document.createElement("canvas").getContext("2d"),r=t.image,b=t.content,E=t.rotate;if(o){_.value||(_.value=document.createElement("div"));const $=$t(),[W,C]=F(o),B=u=>{const[m,y]=P(u||"",E,$,W,C,{color:n.value,fontSize:x.value,fontStyle:z.value,fontWeight:g.value,fontFamily:f.value,textAlign:L.value,textBaseline:d.value},S.value,v.value);N(m,y)};if(r){const u=new Image;u.onload=()=>{B(u)},u.onerror=()=>{B(b)},u.crossOrigin="anonymous",u.referrerPolicy="no-referrer",u.src=r}else B(b)}};return st(()=>{M()}),ut(()=>t,()=>{M()},{deep:!0,flush:"post"}),it(()=>{A()}),ct(w,e=>{k.value||e.forEach(o=>{Ct(o,_.value)&&(A(),M())})},{attributes:!0,subtree:!0,childList:!0}),(e,o)=>(Z(),q("div",{ref_key:"containerRef",ref:w,style:dt([p])},[ft(e.$slots,"default")],4))}});var At=mt(Wt,[["__file","watermark.vue"]]);const Nt=pt(At),Pt={class:"container"},te=Y({__name:"watermark",setup(s){const t=gt({content:"vue-manage-system",font:{fontSize:16,color:"rgba(0, 0, 0, 0.15)"},zIndex:-1,rotate:-22,gap:[100,100],offset:[]});return(p,n)=>{const x=Nt,g=_t,z=Et,f=ht,L=wt,d=Vt,S=St,v=yt,V=bt,h=xt;return Z(),q("div",Pt,[a(h,{gutter:20},{default:i(()=>[a(g,{span:18},{default:i(()=>[a(x,{content:t.content,font:t.font,"z-index":t.zIndex,rotate:t.rotate,gap:t.gap,offset:t.offset},{default:i(()=>n[9]||(n[9]=[vt("div",{style:{height:"600px"}},null,-1)])),_:1},8,["content","font","z-index","rotate","gap","offset"])]),_:1}),a(g,{span:6},{default:i(()=>[a(V,{class:"form",model:t,"label-position":"top","label-width":"50px"},{default:i(()=>[a(f,{label:"Content"},{default:i(()=>[a(z,{modelValue:t.content,"onUpdate:modelValue":n[0]||(n[0]=l=>t.content=l)},null,8,["modelValue"])]),_:1}),a(f,{label:"Color"},{default:i(()=>[a(L,{modelValue:t.font.color,"onUpdate:modelValue":n[1]||(n[1]=l=>t.font.color=l),"show-alpha":""},null,8,["modelValue"])]),_:1}),a(f,{label:"FontSize"},{default:i(()=>[a(d,{modelValue:t.font.fontSize,"onUpdate:modelValue":n[2]||(n[2]=l=>t.font.fontSize=l)},null,8,["modelValue"])]),_:1}),a(f,{label:"zIndex"},{default:i(()=>[a(d,{modelValue:t.zIndex,"onUpdate:modelValue":n[3]||(n[3]=l=>t.zIndex=l)},null,8,["modelValue"])]),_:1}),a(f,{label:"Rotate"},{default:i(()=>[a(d,{modelValue:t.rotate,"onUpdate:modelValue":n[4]||(n[4]=l=>t.rotate=l),min:-180,max:180},null,8,["modelValue"])]),_:1}),a(f,{label:"Gap"},{default:i(()=>[a(v,null,{default:i(()=>[a(S,{modelValue:t.gap[0],"onUpdate:modelValue":n[5]||(n[5]=l=>t.gap[0]=l),"controls-position":"right"},null,8,["modelValue"]),a(S,{modelValue:t.gap[1],"onUpdate:modelValue":n[6]||(n[6]=l=>t.gap[1]=l),"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),a(f,{label:"Offset"},{default:i(()=>[a(v,null,{default:i(()=>[a(S,{modelValue:t.offset[0],"onUpdate:modelValue":n[7]||(n[7]=l=>t.offset[0]=l),placeholder:"offsetLeft","controls-position":"right"},null,8,["modelValue"]),a(S,{modelValue:t.offset[1],"onUpdate:modelValue":n[8]||(n[8]=l=>t.offset[1]=l),placeholder:"offsetTop","controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})])}}});export{te as default};
